# Лабораторная работа 2


## Цель работы
Разработка структуры базы данных и ее подключение к бэкенду

## Порядок показа
1. Показать панель администратора Django/adminer
   - Добавить новую услугу
   - Просмотреть данные через SELECT в БД

2. Показать 3 страницы приложения:
   - Выполнить поиск
   - Удалить заявку
   - Перейти по URL удаленной заявки
   - Добавить две услуги в заявку (изменение карточки корзины)
   - Показать содержимое заявки

3. Показать в БД запросом:
   - Результаты логического удаления
   - Новую заявку

4. В БД изменить поля по теме в заявке и м-м
   - Показать изменения в приложении

5. В коде показать:
   - Модели данных
   - Составной уникальный ключ м-м
   - 4 контроллера через ORM
   - Удаление заявки через SQL UPDATE

## Контрольные вопросы
- Виды БД
- SQL запросы
- Курсоры
- ORM (Object-Relational Mapping)
- Модель и миграции
- Чистая архитектура

## ER диаграмма
Создать в StarUML:
- Таблицы, связи, столбцы
- Типы столбцов и их длина
- Первичные и внешние ключи

## Задание
Создание базы данных PostgreSQL по теме работы и подключение БД к созданным трем шаблонам

## Требования

### Структура БД
**Обязательные таблицы (4):**
1. **Услуги** (`services`)
   - Наименование
   - Описание
   - Статус (удален/действует)
   - URL к изображению (Nullable)
   - Поля по предметной области

2. **Заявки** (`orders`)
   - Обязательные поля (Not Null):
     - `id`
     - `status`
     - `created_at` (datetime)
     - `creator_id`
   - Дополнительные поля:
     - `formed_at` (datetime)
     - `completed_at` (datetime)
     - `moderator_id`
     - Поля по предметной области

3. **Связь м-м заявки-услуги** (`order_services`)
   - Составной уникальный ключ
   - Дополнительные поля: количество/порядок/главный/другое

4. **Пользователи** (`users`)
   - Использовать системную таблицу Django (НЕ создавать свою)
   - Логин, пароль, признак модератора

### Статусы заявок (5+)
- Черновик
- Удалён
- Сформирован
- Завершён
- Отклонён

### Бизнес-логика
- У каждого пользователя не более одной заявки в статусе "черновик"
- При отсутствии заявки в статусе "черновик" у пользователя:
  - Заявка создается только при добавлении услуги
- Если заявка уже существует:
  - Услуга добавляется в существующую заявку
- Удаленные заявки нельзя просматривать
- При отсутствии текущей заявки карточка корзины не активна

### Техническая реализация
**HTTP методы (5):**
- 3 GET: просмотр услуг, детали услуги, просмотр заявки
- 1 POST: добавление услуги в заявку (через ORM)
- 1 POST: удаление заявки (через SQL UPDATE)

**Особенности реализации:**
- Получение и поиск услуг через ORM
- Добавление услуги в заявку через ORM
- Логическое удаление заявки через SQL UPDATE (без ORM)
- Каскадное удаление запрещено!


## Миграции
```bash
# Для Django
python manage.py makemigrations
python manage.py migrate

# Для Golang
# Реализация миграций через скрипты или инструменты типа goose
